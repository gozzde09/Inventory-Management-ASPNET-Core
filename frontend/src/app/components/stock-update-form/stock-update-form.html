<!-- Modal -->
<div class="modal-header">
  <h4 class="modal-title">Saldoändring</h4>
  <button
    type="button"
    class="btn-close"
    aria-label="Close"
    (click)="activeModal.dismiss()"
  ></button>
</div>
<div class="modal-body">
  <form [formGroup]="inventoryForm" (ngSubmit)="onSubmit()">
    <div class="form-group mb-3">
      <label for="article" class="form-label"><strong>Artikelnamn:</strong></label>
      <input type="text" id="article" formControlName="article" class="form-control" readonly />
    </div>

    <div class="form-group mb-3">
      <label for="currentQuantity" class="form-label"><strong>Nuvarande antal: </strong></label>
      <span class="current-quantity"
        >{{ inventoryForm.get('currentQuantity')?.value }} {{ item.unit }}</span
      >
    </div>

    <div class="form-group mb-3">
      <label class="form-label"><strong>Typ av ändring:</strong></label>
      <div class="radio-group">
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            formControlName="changeType"
            value="add"
            id="addRadio"
          />
          <label class="form-check-label" for="addRadio"> Lägg till (påfyllning) </label>
        </div>
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            formControlName="changeType"
            value="remove"
            id="removeRadio"
          />
          <label class="form-check-label" for="removeRadio"> Ta bort (förbrukning) </label>
        </div>
      </div>
    </div>

    <div class="form-group mb-3">
      <label for="quantityChange" class="form-label"><strong>Antal att ändra:</strong></label>
      <div class="input-group">
        <button type="button" class="btn btn-outline-secondary" (click)="decrementQuantity()">
          -
        </button>
        <input
          type="text"
          id="quantityChange"
          formControlName="quantityChange"
          class="form-control text-center"
          pattern="^[0-9]+$"
        />
        <button type="button" class="btn btn-outline-secondary" (click)="incrementQuantity()">
          +
        </button>
      </div>
      @if (!inventoryForm.get('quantityChange')?.value) {
      <div class="text-danger small mt-1">Antal är obligatoriskt.</div>
      } @else if(inventoryForm.get('quantityChange')?.value==0) {
      <div class="text-danger small mt-1">Antal får inte vara null.</div>
      } @else if(inventoryForm.get('quantityChange')?.value<0) {
      <div class="text-danger small mt-1">Antal får inte vara negativt.</div>
      } @else if (inventoryForm.get('quantityChange')?.value &&
      !inventoryForm.get('quantityChange')?.value.toString().match('^[0-9]+$')) {
      <div class="text-danger small mt-1">Antal får bara innehålla siffror.</div>
      } @else if (newBalance<0) {
      <div class="text-danger small mt-1">Lagret kan inte bli negativt.</div>
      }
    </div>
    @if(inventoryForm.valid && newBalance >= 0) { @switch (getStockStatus(newBalance, item)) { @case
    ('danger') {
    <ngb-alert type="danger" [dismissible]="false">
      <strong>Kritiskt nytt saldo: </strong> {{ newBalance }} {{ item.unit }} (efter
      {{ inventoryForm.get('changeType')?.value === 'add' ? '+' : '-' }}
      {{ inventoryForm.get('quantityChange')?.value }})
    </ngb-alert>
    } @case ('warning') {
    <ngb-alert type="warning" [dismissible]="false">
      <strong>Lågt nytt saldo: </strong>{{ newBalance }} {{ item.unit }} (efter
      {{ inventoryForm.get('changeType')?.value === 'add' ? '+' : '-' }}
      {{ inventoryForm.get('quantityChange')?.value }})
    </ngb-alert>
    } @default {
    <ngb-alert type="success" [dismissible]="false">
      <strong>Nytt saldo: </strong>{{ newBalance }} {{ item.unit }} (efter
      {{ inventoryForm.get('changeType')?.value === 'add' ? '+' : '-' }}
      {{ inventoryForm.get('quantityChange')?.value }})
    </ngb-alert>
    } } }
  </form>
</div>
<div class="modal-footer">
  <button type="button" class="btn btn-secondary" (click)="activeModal.dismiss()">Avbryt</button>
  <button
    type="button"
    class="btn btn-blue"
    (click)="onSubmit()"
    [disabled]="inventoryForm.invalid || newBalance < 0"
  >
    Uppdatera saldo
  </button>
</div>
