<!-- Modal -->
<div class="modal-header">
  <h4 class="modal-title">Saldoändring</h4>
</div>
<div class="modal-body">
  <form [formGroup]="inventoryForm" (ngSubmit)="onSubmit()">
    <div class="form-group mb-3">
      <label for="article" class="form-label"><strong>Artikelnamn:</strong></label>
      <input type="text" id="article" formControlName="article" class="form-control" readonly />
    </div>

    <div class="form-group mb-3">
      <label for="currentQuantity" class="form-label"><strong>Nuvarande antal:</strong></label>
      <span class="current-quantity">
        {{ inventoryForm.get('currentQuantity')?.value }} {{ item.unit }}</span
      >
    </div>

    <div class="form-group mb-3">
      <label class="form-label"><strong>Typ av ändring:</strong></label>
      <div class="radio-group">
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            formControlName="changeType"
            value="add"
            id="addRadio"
          />
          <label class="form-check-label" for="addRadio">Lägg till (påfyllning) </label>
        </div>
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            formControlName="changeType"
            value="remove"
            id="removeRadio"
          />
          <label class="form-check-label" for="removeRadio"> Ta bort (förbrukning) </label>
        </div>
      </div>
    </div>

    <div class="form-group mb-3">
      <label for="quantityChange" class="form-label"><strong>Antal att ändra:</strong></label>
      <div class="input-group">
        <button type="button" class="btn btn-outline-secondary" (click)="decrementQuantity()">
          -
        </button>
        <input
          type="text"
          id="quantityChange"
          formControlName="quantityChange"
          class="form-control text-center"
          min="1"
        />
        <button type="button" class="btn btn-outline-secondary" (click)="incrementQuantity()">
          +
        </button>
      </div>
      @if (inventoryForm.get('quantityChange')?.errors?.['required']) {
      <div class="text-danger small mt-1">Antal är obligatoriskt.</div>
      } @else if (inventoryForm.get('quantityChange')?.value==0) {
      <div class="text-danger small mt-1">Antal får inte vara 0.</div>
      } @else if (inventoryForm.get('quantityChange')?.errors?.['nonNegative']) {
      <div class="text-danger small mt-1">Antal får inte vara negativt.</div>
      } @else if (inventoryForm.get('quantityChange')?.errors?.['digitsOnly']) {
      <div class="text-danger small mt-1">Antal får bara innehålla siffror.</div>
      } @if (inventoryForm.errors?.['stockNegative']) {
      <div class="text-danger small mt-1">Lagret kan inte bli negativt.</div>
      }
    </div>
    @if(inventoryForm.valid && !inventoryForm.errors?.['stockNegative']) { @switch
    (getStockStatus(newBalance, item)) { @case ('danger') {
    <ngb-alert type="danger" [dismissible]="false">
      <i class="bi bi-exclamation-triangle me-2"></i>
      <strong>Varning - Kritiskt lågt saldo!</strong><br />
      Nytt saldo blir: <strong>{{ newBalance }} {{ item.unit }}</strong>
      <small class="d-block mt-1">
        {{ inventoryForm.get('changeType')?.value === 'add' ? 'Tillkommer' : 'Tas ut' }}:
        {{ inventoryForm.get('quantityChange')?.value }} {{ item.unit }}
      </small>
    </ngb-alert>

    } @case ('warning') {
    <ngb-alert type="warning" [dismissible]="false">
      <i class="bi bi-exclamation-circle me-2"></i>
      <strong>Observera - Lågt saldo</strong><br />
      Nytt saldo blir: <strong>{{ newBalance }} {{ item.unit }}</strong>
      <small class="d-block mt-1">
        {{ inventoryForm.get('changeType')?.value === 'add' ? 'Tillkommer' : 'Tas ut' }}:
        {{ inventoryForm.get('quantityChange')?.value }} {{ item.unit }}
      </small>
    </ngb-alert>

    } @default {
    <ngb-alert type="success" [dismissible]="false">
      <i class="bi bi-check-circle me-2"></i>
      <strong>Förhandsgranskning</strong><br />
      Nytt saldo blir: <strong>{{ newBalance }} {{ item.unit }}</strong>
      <small class="d-block mt-1">
        {{ inventoryForm.get('changeType')?.value === 'add' ? 'Tillkommer' : 'Tas ut' }}:
        {{ inventoryForm.get('quantityChange')?.value }} {{ item.unit }}
      </small>
    </ngb-alert>
    } } }
  </form>
</div>

<div class="modal-footer">
  <button type="button" class="btn btn-outline-secondary" (click)="activeModal.dismiss()">
    Avbryt
  </button>
  <button
    type="button"
    class="btn btn-blue"
    (click)="onSubmit()"
    [disabled]="inventoryForm.invalid || newBalance < 0"
  >
    Uppdatera saldo
  </button>
</div>
