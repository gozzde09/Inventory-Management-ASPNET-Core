<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Lagerhantering</h2>
  </div>

  <button class="btn btn-success" (click)="openAddForm()" [disabled]="isAddFormVisible()">
    <i class="fas fa-plus me-2"></i>
    {{ isAddFormVisible() ? 'Formulär öppet' : 'Ny artikel' }}
  </button>
  @if(isAddFormVisible()) {
  <div class="mb-4">
    <app-add-item-form (itemAdded)="onItemAdded($event)" (cancel)="closeAddForm()">
    </app-add-item-form>
  </div>
  }
  <p class="text-muted">
    Totalt {{ items().length }} {{ items().length === 1 ? 'artikel' : 'artiklar' }}
  </p>

  <div class="table-responsive rounded-3 overflow-hidden">
    <table class="table table-bordered table-hover">
      <thead class="table-dark">
        <tr>
          <th>Artikelnamn</th>
          <th>Antal</th>
          <th>Enhet</th>
          <th>Status</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        @for (item of items(); track item.id) {
        <tr [ngClass]="getStatusClass(item.statusColor)">
          <!-- Edit-läge -->
          @if (editId === item.id) {
          <td>
            <input [(ngModel)]="editItem.name" class="form-control" name="editName" />
          </td>
          <td>
            <input
              type="number"
              [(ngModel)]="editItem.quantity"
              class="form-control"
              name="editQuantity"
              min="0"
            />
          </td>
          <td>
            <input [(ngModel)]="editItem.unit" class="form-control" name="editUnit" />
          </td>
          <td>
            <button class="btn btn-success btn-sm me-2" (click)="saveEdit(item)">Spara</button>
            <button class="btn btn-secondary btn-sm" (click)="cancelEdit()">Avbryt</button>
          </td>
          } @else {
          <!-- Läs-läge -->
          <td>{{ item.name }}</td>
          <td>{{ item.quantity }}</td>
          <td>{{ item.unit }}</td>
          <td>{{ item.statusColor }}</td>
          <td>
            <button class="btn btn-warning btn-sm me-2" (click)="startEdit(item)">Redigera</button>
            <button class="btn btn-danger btn-sm" (click)="deleteItem(item)">Ta bort</button>
          </td>

          }
        </tr>
        } @empty {
        <tr>
          <td colspan="5" class="text-center text-muted">Inga artiklar hittades</td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>
