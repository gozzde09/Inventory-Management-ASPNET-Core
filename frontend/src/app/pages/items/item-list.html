<h3 class="text-center text-nowrap mt-2">Lagerstatus - Artiklarlista</h3>
<div class="container mt-4">
  @if(!isAddFormVisible()) {
  <div class="d-flex justify-content-end mb-0">
    <button class="btn btn-success" (click)="openAddForm()" [disabled]="isAddFormVisible()">
      <i class="bi bi-plus"></i>
      Ny artikel
    </button>
  </div>
  } @else {
  <div class="mb-2">
    <app-add-item-form
      [existingItems]="items()"
      (itemAdded)="onItemAdded($event)"
      (cancel)="closeAddForm()"
    >
    </app-add-item-form>
  </div>
  }
  <p class="text-muted">
    Totalt <strong>{{ items().length }} </strong>
    {{ items().length === 1 ? 'artikel' : 'artiklar' }}
  </p>

  <div class="table-responsive rounded-4 overflow-hidden">
    <table class="table table-bordered table-hover">
      <thead id="table-header-custom">
        <tr id="table-header-custom" class="text-center">
          <th>#</th>
          <th>Artikelnamn</th>
          <th>Antal</th>
          <th class="d-none d-sm-table-cell">Status</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        @for (item of items(); track item.id; let index = $index) {
        <tr [ngClass]="getStatusClass(item.statusColor)">
          <td>{{ index + 1 }}</td>
          <td>{{ item.name }}</td>
          <td>{{ item.quantity }} {{ item.unit }}</td>
          <td class="d-none d-sm-table-cell">
            @if (item.statusColor === 'red') {
            <span class="badge fw-medium text-bg-danger">Kritiskt</span>
            } @else if (item.statusColor === 'yellow') {
            <span class="badge fw-medium text-bg-warning">Lågt</span>
            } @else if (item.statusColor === 'green') {
            <span class="badge fw-medium text-bg-success">OK</span>
            }
          </td>
          <td class="d-flex justify-content-evenly align-items-center flex-wrap">
            <div>
              <i
                class="bi bi-pencil me-2 blue-icon fs-6"
                ngbTooltip="Redigera"
                (click)="startEdit(item)"
              ></i>
              <i
                class="bi bi-trash me-2 blue-icon fs-6"
                ngbTooltip="Radera"
                (click)="openDeleteConfirmation(item)"
              ></i>
            </div>
            <button
              class="btn btn-blue btn-sm mt-1 mt-sm-0 p-1"
              (click)="openStockUpdateModal(item)"
            >
              Saldoändring
            </button>
          </td>
        </tr>
        <!-- Edit-mode -->
        @if (editId === item.id) {
        <tr>
          <td>{{ index + 1 }}</td>
          <td colspan="6" class="text-start">
            <app-edit-item-form
              [item]="editItem"
              (save)="saveEdit($event)"
              (cancel)="cancelEdit()"
            ></app-edit-item-form>
          </td>
        </tr>
        } } @empty {
        <tr>
          <td colspan="5" class="text-center text-muted">Inga artiklar hittades</td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>
