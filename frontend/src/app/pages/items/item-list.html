<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Lagerhantering</h2>
  </div>

  @if(!isAddFormVisible()) {
  <div class="d-flex justify-content-end mb-3">
    <button class="btn blue-button" (click)="openAddForm()" [disabled]="isAddFormVisible()">
      <i class="bi bi-plus"></i>
      Ny artikel
    </button>
  </div>
  } @else {
  <div class="mb-4">
    <app-add-item-form
      [existingItems]="items()"
      (itemAdded)="onItemAdded($event)"
      (cancel)="closeAddForm()"
    >
    </app-add-item-form>
  </div>
  }
  <p class="text-muted">
    Totalt {{ items().length }} {{ items().length === 1 ? 'artikel' : 'artiklar' }}
  </p>

  <div class="table-responsive rounded-3 overflow-hidden">
    <table class="table table-bordered table-hover">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Artikelnamn</th>
          <th>Antal</th>
          <th>Enhet</th>
          <th>Status</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        @for (item of items(); track item.id; let index=$index) {
        <tr [ngClass]="getStatusClass(item.statusColor)">
          <!-- Edit-läge -->
          @if (editId === item.id) {
          <td>
            <input [(ngModel)]="editItem.name" class="form-control" name="editName" />
          </td>
          <td>
            <input
              type="number"
              [(ngModel)]="editItem.quantity"
              class="form-control"
              name="editQuantity"
              min="0"
            />
          </td>
          <td>
            <input [(ngModel)]="editItem.unit" class="form-control" name="editUnit" />
          </td>
          <td>
            <button class="btn btn-success btn-sm me-2" (click)="saveEdit(item)">Spara</button>
            <button class="btn btn-secondary btn-sm" (click)="cancelEdit()">Avbryt</button>
          </td>
          } @else {
          <td>{{ index + 1 }}</td>
          <td>{{ item.name }}</td>
          <td>{{ item.quantity }}</td>
          <td>{{ item.unit }}</td>
          <td>{{ item.statusColor }}</td>
          <td class="d-flex justify-content-evenly">
            <i class="bi bi-pencil me-2 blue-icon" (click)="startEdit(item)"></i>
            <i class="bi bi-trash me-2 blue-icon" (click)="deleteItem(item)"></i>
            <button class="btn blue-button btn-sm" (click)="openStockUpdateModal(item)">
              Saldoändring
            </button>
          </td>
          }
        </tr>

        } @empty {
        <tr>
          <td colspan="7" class="text-center text-muted">Inga artiklar hittades</td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>
